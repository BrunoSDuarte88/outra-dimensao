{% extends 'portal/base.html' %}
{% load static %}

{% block title %}Administração{% endblock %}

{% block content %}
<div class="acp-container">
    <h2>Administração do Site</h2>
    <div class="acp-frame">

        <!-- Abas internas -->
        <div class="acp-tabs-internas">
            <button class="aba-btn active" onclick="resetarAbaGeral()">GERAL</button>
            <button class="aba-btn" onclick="mostrarPainel('painel-foruns')">FÓRUNS</button>
            <!--<button class="aba-btn" onclick="mostrarAba('painel-foruns')">FÓRUNS</button>-->
            <button class="aba-btn" onclick="mostrarAba('painel-postagens')">POSTAGEM</button>
            <button class="aba-btn" onclick="mostrarAba('painel-usuarios-grupos')">USUÁRIOS E GRUPOS</button>
            <button class="aba-btn" onclick="mostrarAba('painel-permissoes')">PERMISSÕES</button>
            <button class="aba-btn" onclick="mostrarAba('painel-personalizar')">PERSONALIZAR</button>
            <button class="aba-btn" onclick="mostrarAba('painel-manutencao')">MANUTENÇÃO</button>
            <button class="aba-btn" onclick="mostrarAba('painel-sistema')">SISTEMA</button>
            <button class="aba-btn" onclick="mostrarAba('painel-extensoes')">EXTENSÕES</button>
        </div>

        <!-- Conteúdo da aba GERAL -->
        <div id="geral" class="aba-conteudo active">
            <div class="acp-geral-layout">
                <!-- Menu lateral -->
                    <div class="acp-sidebar">
                        <h3>Acesso rápido</h3>

                        <!-- Menu da aba GERAL (visível por padrão) -->
                        <ul id="menu-geral" class="menu-lateral" style="display: block;">
                            <li><a href="#" onclick="mostrarPainel('painel-usuarios')">Gerenciar usuários</a></li>
                            <li><a href="#" onclick="mostrarPainel('painel-grupos')">Gerenciar grupos</a></li>
                            <li><a href="#" onclick="mostrarPainel('painel-foruns')">Gerenciar fóruns</a></li>
                            <li><a href="#">Registro do moderador</a></li>
                        </ul>

                        <!-- Menu da aba FÓRUNS (escondido por padrão) -->
                        <ul id="menu-foruns" class="menu-lateral" style="display: none;">
                            <li><a href="#" onclick="mostrarPainel('painel-foruns')">Gerenciar fóruns</a></li>
                            <li><a href="#">Fóruns de poda</a></li>
                            <li><a href="#">Permissões baseadas em fórum</a></li>
                            <li><a href="#">Permissões do fórum</a></li>
                            <li><a href="#">Copiar permissões do fórum</a></li>
                            <li><a href="#">Moderadores do fórum</a></li>
                            <li><a href="#">Permissões do fórum do usuário</a></li>
                            <li><a href="#">Permissões do fórum do grupo</a></li>
                        </ul>

                        <!-- Você pode adicionar outros menus depois: menu-posts, menu-categorias, etc -->
                    </div>

                <!-- Painel principal -->
                <div id="conteudo-geral" class="bloco-conteudo ativo">
                <div class="acp-main-panel">
                    <h2>Bem-vindo ao ACP</h2>
                    <p>Obrigado por escolher a plataforma Outra Dimensão. Aqui você terá uma visão geral rápida das estatísticas do seu site. Use o menu à esquerda para acessar as ferramentas administrativas.</p>

                    <!-- Tabela de estatísticas -->
                    <table class="acp-stats-table">
                        <thead>
                            <tr><th colspan="2">Estatísticas Gerais</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>Início do site:</td><td>20 de Julho de 2025</td></tr>
                            <tr><td>Usuários registrados:</td><td>1</td></tr>
                            <tr><td>Total de postagens:</td><td>1</td></tr>
                            <tr><td>Total de tópicos:</td><td>1</td></tr>
                            <tr><td>Tamanho do banco de dados:</td><td>1,07 MiB</td></tr>
                            <tr><td>Servidor de banco de dados:</td><td>SQLite 3.26.0</td></tr>
                            <tr><td>Versão do Python:</td><td>3.11</td></tr>
                            <tr><td>Versão da plataforma:</td><td>Outra Dimensão 1.0</td></tr>
                        </tbody>
                    </table>

                    <br>

                    <!-- Ações administrativas -->
                    <h3>Ações rápidas</h3>
                    <ul>
                        <li><button>Ressincronizar estatísticas</button></li>
                        <li><button>Redefinir data de início</button></li>
                        <li><button>Limpar cache</button></li>
                        <li><button>Limpar sessões</button></li>
                    </ul>

                    <br>

                    <!-- Log de administrador -->
                    <h3>Ações do administrador registradas</h3>
                    <table class="acp-stats-table">
                        <thead>
                            <tr>
                                <th>Nome de usuário</th>
                                <th>IP</th>
                                <th>Data/Hora</th>
                                <th>Ação</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>administrador</td>
                                <td>189.110.36.238</td>
                                <td>Dom, 20 de Julho de 2025, 14:28</td>
                                <td>Login de administração bem-sucedido</td>
                            </tr>
                            <!-- Outros registros podem ser adicionados aqui -->
                        </tbody>
                    </table>

                    <br>

                    <!-- Usuários inativos -->
                    <h3>Usuários inativos</h3>
                    <p>Nenhum usuário inativo no momento.</p>
                </div>

                <!-- ✅ PAINEL QUE VAI SUBSTITUIR O CONTEÚDO AO CLICAR -->
                    <div id="painel-usuarios" class="painel-acp acp-main-panel" style="display: none;">
                    <!--<div id="painel-usuarios" class="painel-acp" style="display: none;">-->
                        <h2>Administração de usuários</h2>
                        <p>Aqui você pode alterar as informações dos usuários e certas opções específicas.</p>

                        <h3>Selecione o usuário</h3>
                        <label>Digite o nome de usuário:</label>
                        <div style="margin-top: 5px; margin-bottom: 10px;">
                            <input type="text" placeholder="Digite um nome..." style="padding: 5px; width: 60%;">
                            <a href="#" style="margin-left: 10px; color: #00aaff;">[ Encontre um membro ]</a>
                        </div>

                        <label>
                            <input type="checkbox"> Selecione um usuário anônimo
                        </label>
                    </div> <!-- ✅ FIM DO painel-usuarios -->

                    <div id="painel-grupos" class="painel-acp acp-main-panel" style="display: none;">
                        <h2>Gerenciar grupos</h2>
                        <p>Neste painel, você pode administrar todos os seus grupos de usuários. Você pode excluir, criar e editar grupos existentes, além de definir nome e descrição.</p>

                        <h3>Grupos definidos pelo usuário</h3>
                        <table class="acp-stats-table">
                            <thead>
                                <tr>
                                    <th>Grupo</th>
                                    <th>Membros</th>
                                    <th>Pendente</th>
                                    <th>Opções</th>
                                    <th>Ação</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="5">Nenhum grupo criado ainda.</td>
                                </tr>
                            </tbody>
                        </table>

                        <div style="margin-top: 15px;">
                            <label>Criar novo grupo:</label>
                            <input type="text" style="padding: 4px;">
                            <button style="margin-left: 5px;">Enviar</button>
                        </div>

                        <br><br>

                        <h3>Grupos predefinidos</h3>
                        <table class="acp-stats-table">
                            <thead>
                                <tr>
                                    <th>Grupo</th>
                                    <th>Membros</th>
                                    <th>Pendente</th>
                                    <th>Opções</th>
                                    <th>Ação</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="color: red;">Administradores</td>
                                    <td>1</td><td>0</td>
                                    <td><a href="#">Configurações</a></td>
                                    <td><a href="#">Excluir</a></td>
                                </tr>
                                <tr>
                                    <td style="color: gray;">Robôs</td>
                                    <td>49</td><td>0</td>
                                    <td><a href="#">Configurações</a></td>
                                    <td><a href="#">Excluir</a></td>
                                </tr>
                                <tr>
                                    <td style="color: green;">Moderadores globais</td>
                                    <td>1</td><td>0</td>
                                    <td><a href="#">Configurações</a></td>
                                    <td><a href="#">Excluir</a></td>
                                </tr>
                                <tr>
                                    <td>Convidados</td>
                                    <td>0</td><td>0</td>
                                    <td><a href="#">Configurações</a></td>
                                    <td><a href="#">Excluir</a></td>
                                </tr>
                                <tr>
                                    <td>Usuários recém-registrados</td>
                                    <td>1</td><td>0</td>
                                    <td><a href="#">Configurações</a></td>
                                    <td><a href="#">Excluir</a></td>
                                </tr>
                                <tr>
                                    <td>Usuários registrados</td>
                                    <td>1</td><td>0</td>
                                    <td><a href="#">Configurações</a></td>
                                    <td><a href="#">Excluir</a></td>
                                </tr>
                                <tr>
                                    <td>Usuários registrados da COPPA</td>
                                    <td>0</td><td>0</td>
                                    <td><a href="#">Configurações</a></td>
                                    <td><a href="#">Excluir</a></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div id="painel-foruns" class="painel-acp acp-main-panel" style="display: none;">
                        <div class="acp-bloco-centro">
                            <h2>Administração do fórum</h2>
                            <p>No phpBB3, tudo é baseado em fóruns. Uma categoria é apenas um tipo especial de fórum. Cada fórum pode ter um número ilimitado de subfóruns e você pode determinar se cada um pode receber ou não postagens (ou seja, se funciona como uma categoria antiga).</p>
                            <p>Aqui você pode adicionar, editar, excluir, bloquear e desbloquear fóruns individuais, bem como definir certos controles adicionais. Se suas postagens e tópicos estiverem fora de sincronia, você também pode ressincronizar um fórum.</p>
                            <p style="font-weight: bold; color: #004488;">Você precisa copiar ou definir as permissões apropriadas para fóruns recém-criados para que eles sejam exibidos.</p>

                            <h3>Índice do quadro</h3>
                            <div class="acp-categoria-forum">
                                <img src="{% static 'portal/img/icone-categoria.png' %}" alt="Ícone" style="vertical-align: middle; margin-right: 8px;">
                                <span>Sua primeira categoria</span>
                            </div>

                            <div class="acp-forum-controles">
                                <label>Selecione um fórum:</label>
                                <select>
                                    <option>Sua primeira categoria</option>
                                </select>
                                <button style="margin-left: 5px;">Ir</button>
                            </div>

                            <div class="acp-forum-criar" style="margin-top: 20px;">
                                <input type="text" placeholder="Nome do novo fórum" style="padding: 4px;">
                                <button style="margin-left: 5px;">Criar novo fórum</button>
                            </div>
                        </div>
                    </div>


            </div>



        </div>


        <!-- Conteúdo das abas -->



        <!--<div id="usuarios" class="aba-conteudo active">
            <p>Gerenciamento de usuários aqui.</p>
        </div>-->
        <div id="grupos" class="aba-conteudo">
            <p>Gerenciamento de grupos aqui.</p>
        </div>
        <div id="categorias" class="aba-conteudo">
            <p>Gerenciamento de categorias aqui.</p>
        </div>
        <div id="posts" class="aba-conteudo">
            <p>Gerenciamento de posts aqui.</p>
        </div>
    </div>
</div>

<script>

function mostrarAba(abaId, forcarReset = false) {
    // Esconde todas as abas
    const abas = document.querySelectorAll('.aba-conteudo');
    abas.forEach(aba => aba.classList.remove('active'));

    // Marca a aba ativa
    const abaAtiva = document.getElementById(abaId);
    if (abaAtiva) abaAtiva.classList.add('active');

    // Atualiza botões
    const botoes = document.querySelectorAll('.aba-btn');
    botoes.forEach(btn => btn.classList.remove('active'));

    if (abaId === 'geral') {
        botoes[0].classList.add('active');

        // ✅ Aqui forçamos o reset mesmo se já estiver na aba
        if (forcarReset) {
            const paineis = document.querySelectorAll('#conteudo-geral > .painel-acp, #conteudo-geral > .acp-main-panel');
            paineis.forEach(painel => painel.style.display = 'none');
            const painelPrincipal = document.querySelector('#conteudo-geral > .acp-main-panel');
            if (painelPrincipal) painelPrincipal.style.display = 'block';
        }

        mostrarMenuLateral('menu-geral');  // <<< Aqui exibe o menu correto
    } else {
        const btn = Array.from(botoes).find(btn => btn.onclick?.toString().includes(`mostrarAba('${abaId}')`));
        if (btn) btn.classList.add('active');

        if (abaId === 'foruns') {
            mostrarMenuLateral('menu-foruns');  // <<< Aqui exibe o menu correto
        }
        // Se quiser, adicione outros menus para outras abas aqui, por exemplo:
        // else if (abaId === 'posts') mostrarMenuLateral('menu-posts');
    }
}

// Função para mostrar o menu lateral correto, sem alterar o que já está funcionando:
function mostrarMenuLateral(menuId) {
    const menus = document.querySelectorAll('.menu-lateral');
    menus.forEach(menu => menu.style.display = 'none');

    const menuAtivo = document.getElementById(menuId);
    if (menuAtivo) menuAtivo.style.display = 'block';
}



function voltarParaGeral() {
    mostrarAba('geral');
}

function mostrarPainel(painelId) {
    // Esconde todos os painéis
    const paineis = document.querySelectorAll('#conteudo-geral > .painel-acp, #conteudo-geral > .acp-main-panel');
    paineis.forEach(painel => painel.style.display = 'none');

    // Mostra o painel desejado
    const painelAtivo = document.getElementById(painelId);
    if (painelAtivo) painelAtivo.style.display = 'block';

    // === NOVO: Atualiza visual dos botões ===
    const botoes = document.querySelectorAll('.aba-btn');
    botoes.forEach(btn => btn.classList.remove('active'));

    const botaoAtivo = Array.from(botoes).find(btn =>
        btn.getAttribute('onclick')?.includes(`mostrarPainel('${painelId}')`)
    );
    if (botaoAtivo) botaoAtivo.classList.add('active');
}


function resetarAbaGeral() {
    mostrarAba('geral');

    const paineis = document.querySelectorAll('#conteudo-geral > .painel-acp, #conteudo-geral > .acp-main-panel');
    paineis.forEach(painel => painel.style.display = 'none');

    const painelPrincipal = document.querySelector('#conteudo-geral > .acp-main-panel');
    if (painelPrincipal) painelPrincipal.style.display = 'block';
}


</script>


{% endblock %}
